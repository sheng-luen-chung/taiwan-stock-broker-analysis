# 🚀 一鍵下載股票券商進出明細工具

我已經為您整理了一個完整的 Python 工具，可以自動下載指定股票代碼的券商買賣明細 CSV 檔案。

## 📁 檔案說明

### 主要程式
1. **`stock_scraper.py`** - 主程式（OCR 自動識別驗證碼）
2. **`stock_scraper_manual.py`** - 手動驗證碼版本
3. **`simple_downloader.py`** - 簡化版下載器
4. **`broker_pipeline.py`** - 券商數據深度分析工具

### 批次檔工具
5. **`快速下載.bat`** - 一鍵下載股票資料
6. **`分析2317_121846.bat`** - 特定檔案分析範例
7. **`處理鴻海2317.bat`** - 鴻海股票專用分析

### 安裝與設定
8. **`install.bat`** - 自動安裝所有必要套件
9. **`check_installation.py`** - 驗證安裝結果（診斷工具）
10. **`requirements.txt`** - 套件相依性清單

### 說明文件
11. **`README.md`** - 詳細使用說明文檔
12. **`快速使用指南.md`** - 快速入門指南（本檔案）
13. **`HackMD_文檔.md`** - 完整技術文檔
14. **`INSTALL.md`** - 詳細安裝指南

## ⚡ 快速開始

### 第一步：下載股票資料

#### 方法一：使用批次檔（最簡單）
1. 雙擊 `快速下載.bat`
2. 輸入股票代碼（例如：4958）
3. 等待下載完成

#### 方法二：使用命令列
```bash
# OCR 自動版（推薦）
python stock_scraper.py 2317

# 手動驗證碼版（OCR 安裝困難時）
python stock_scraper_manual.py 2317

# 簡化版
python simple_downloader.py

# 設定重試次數
python stock_scraper.py 2317 --retries 10
```

### 第二步：深度分析（可選）

下載完成後，可以進行券商進出深度分析：

#### 方法一：使用批次檔
```bash
# 雙擊執行特定分析
分析2317_121846.bat
處理鴻海2317.bat
```

#### 方法二：使用命令列
```bash
# 分析指定檔案
python broker_pipeline.py --input "2317_處理後資料_20250907_110152.csv"

# 使用預設檔案
python broker_pipeline.py
```

### 分析結果會包含：
- 📊 資料展平與清理
- 🏢 分點券商統計
- 🏛️ 母券商統計
- 💰 平均價格法損益
- 📈 FIFO 法損益分析
- 🏆 前十大獲利/虧損券商
- 🔄 淨買賣超排行榜

## 📊 功能特色

✅ **自動識別驗證碼** - 使用 OCR 技術自動識別  
✅ **一鍵下載** - 輸入股票代碼即可下載 CSV  
✅ **自動重試** - 驗證碼錯誤時自動重試  
✅ **即時分析** - 顯示買賣超統計排行  
✅ **自動命名** - CSV 檔案包含股票代碼和時間戳記  
✅ **深度分析** - 券商進出 FIFO 撮合損益分析  
✅ **分類儲存** - 不同檔案分析結果自動分開  
✅ **多種版本** - OCR 自動版 + 手動版 + 簡化版  
✅ **Excel 支援** - 分析結果同時輸出 CSV 和 Excel 格式  

## 📋 輸出範例

下載成功後會顯示：
```
✅ 下載成功！
📄 檔案: 4958_券商明細_20250907_103020.csv
📂 位置: G:\我的雲端硬碟\broker_analysis\4958_券商明細_20250907_103020.csv

=== 資料分析結果 (股票代碼: 4958) ===
總交易筆數: 5882
券商家數: 203

前 10 大買超券商:
   1. 元大永豐       買超:      798張 (買:      800張, 賣:        2張)
   2. 元大永豐       買超:      695張 (買:      702張, 賣:        7張)
   3. 台灣摩根       買超:      429張 (買:      490張, 賣:       61張)
   ...
```

## 🎯 常用股票代碼

| 代碼 | 名稱 | 產業 | 代碼 | 名稱 | 產業 |
|------|------|------|------|------|------|
| **2317** | 鴻海 | 電子 | **2330** | 台積電 | 半導體 |
| **4958** | 臻鼎-KY | 電路板 | **2454** | 聯發科 | 半導體 |
| **2412** | 中華電 | 電信 | **1301** | 台塑 | 塑膠 |
| **2881** | 富邦金 | 金融 | **2882** | 國泰金 | 金融 |

## 🔧 如果遇到問題

### 0. 先執行診斷工具
如果遇到任何問題，先執行診斷：
```bash
python check_installation.py
```
這會自動檢查所有套件安裝狀況和系統設定。

### 1. 套件安裝
如果提示缺少套件，請執行：
```bash
pip install requests beautifulsoup4 ddddocr lxml
```

### 2. 驗證碼識別失敗
- 程式會自動重試 5 次
- 網路不穩定時可能需要多試幾次

### 3. ddddocr 安裝問題
```bash
pip install ddddocr onnxruntime
```

## 💡 使用技巧

1. **建議使用時間**: 收盤後（下午 2:30 以後）數據較完整
2. **避免重複請求**: 間隔至少 10 秒再下載其他股票
3. **檔案管理**: CSV 檔案會自動命名，包含時間戳記

## 🎉 完成！

現在您可以：
- 雙擊 `快速下載.bat` 開始使用
- 或在命令列執行 `python stock_scraper.py 股票代碼`
- CSV 檔案會自動下載到當前資料夾

## 📚 更多資訊

- 📖 **詳細說明**: 查看 `README.md`
- 🌐 **完整文檔**: 查看 `HackMD_文檔.md`
- 💡 **技術支援**: 如有問題歡迎詢問

有任何問題隨時告訴我！
