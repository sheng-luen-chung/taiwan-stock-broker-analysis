
# 台灣證券交易所券商進出明細分析工具

這個工具可以自動下載指定股票代碼的券商買賣明細，並立即進行完整的分析流程，輸出 CSV 與 Excel 報表。

## 功能特色
- 🚀 **一鍵下載 + 分析**：輸入股票代碼即可自動爬取並生成完整分析
- 🔍 **自動識別驗證碼**：內建 OCR 引擎，自動處理證交所驗證碼
- 📊 **完整分析管線**：
  - 資料展平
  - 分點/母券商統計
  - 平均價格法損益分析
  - FIFO 損益分析（含結轉）
  - 前十大獲利/虧損券商
  - 淨買賣超分析
- 📂 **自動整理**：每次分析結果會放在 `output/analysis_<檔名>` 底下

---

## 安裝需求

### 1. 建立虛擬環境（推薦）
```bash
python -m venv .venv
.\.venv\Scripts\activate   # Windows
source .venv/bin/activate  # macOS/Linux
````

### 2. 安裝套件

```bash
pip install -r requirements.txt
```

---

## 使用方法

### 基本用法

```bash
# 下載鴻海(2317) 並直接分析
python run_pipeline.py 2317

# 下載臻鼎-KY(4958) 並直接分析
python run_pipeline.py 4958
```

### 參數選項

```bash
python run_pipeline.py <股票代碼> [--retries N] [--outdir output] [--fee-discount 0.28] [--day-trade-tax 0.0015]
```

* `股票代碼`：例如 2317 (鴻海)、2330 (台積電)
* `--retries`：驗證碼重試次數（預設 5）
* `--outdir`：輸出資料夾（預設 `output`）
* `--fee-discount`：手續費折扣（預設 0.28）
* `--day-trade-tax`：當沖證交稅（預設 0.0015）

---

## 輸出結果

假設輸入股票代碼 `4958`，會得到：

1. 爬蟲原始檔：`4958_爬蟲資料_20250908_202210.csv`
2. 處理後檔：`4958_處理後資料_20250908_202210.csv`
3. 分析報表：`output/analysis_4958_處理後資料_20250908_202210/step*.csv|xlsx`

---

## 常見股票代碼

| 代碼   | 公司名稱  | 產業類別  |
| ---- | ----- | ----- |
| 2330 | 台積電   | 半導體   |
| 2317 | 鴻海    | 電子零組件 |
| 2454 | 聯發科   | 半導體   |
| 2412 | 中華電   | 電信服務  |
| 4958 | 臻鼎-KY | 印刷電路板 |
| 1301 | 台塑    | 塑膠工業  |

---

## 注意事項

* 僅限學術研究與個人使用
* 請避免過度頻繁請求，建議每次下載間隔 ≥ 10 秒
* 收盤後（14:30 以後）數據最完整
